{% load i18n %}
{% trans '帳號管理' as account_management %}
{% trans '登出' as log_out %}
{% trans '刪除帳號' as delete_account %}
<div>
    <nav class="navbar navbar-expand-sm fixed-top" style="background-color:#3399ff">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="navbar-brand" href="/home/" style="color:#ffffff">{% trans '主頁' %}</a>
            </li>
            <li class="nav-item">
                <a class="navbar-brand" href="/DPSyn/" style="color:#ffffff">DPView</a>
            </li>
            <li class="nav-item" >
                <a class="navbar-brand" href="/t_Closeness/" style="color:#ffffff">k-Anonymity</a>
            </li>
            {% if false %}
                <li class="nav-item">
                    <a class="navbar-brand" href="/k_Anonymity/" style="color:#ffffff">k-Anonymity</a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="/l_Diversity/" style="color:#ffffff">l-Diversity</a>
                </li>
            {% endif %}
            {% if user.is_authenticated %}
            <li class="nav-item">
                <select id="account" name="account" class="form-control">
                    <option value="{{ account_management }}" selected>{{ account_management }}</option>
                    <option value="{{ log_out }}">{{ log_out }}</option>
                    <option value="{{ delete_account }}">{{ delete_account }}</option>
                </select>
            </li>
            {% endif %}
            <li class="nav-item">
                <form id="i18n" action="{% url 'set_language' %}" method="post">
                    {% csrf_token %}
                    <input name="next" type="hidden" value="{{ request.get_full_path|remove_language_code }}" />
                    <select name="language" class="form-control language-switch">
                        {% for code, name in LANGUAGES %}
                            <option value="{{ code }}" {% if code == LANGUAGE_CODE %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </form>
            </li>
        </ul>
    </nav>
</div>

<script>
    function delete_account() {
        answer = prompt("{% trans '帳號即將刪除，刪除後資料無法回復，如確定要刪除請輸入密碼' %}", '');
        var url = '{% url 'delete_account' %}';
        var data = {
            'password' : answer,
        };
        $.ajax({
            url: url,
            type: 'GET',
            data: data,
            success: function () {
                window.location = "{% url 'login' %}";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var jsonObj = JSON.parse(xhr.responseText);
                alert(jsonObj.message);
            }
        });
    }
    
    $(function () {
        $('#account').change(function () {
            selected = $(this).find(':selected').val();
            if (selected == '{{ log_out }}') {
                window.location = "{% url 'logout' %}";
            } else if (selected == '{{ delete_account }}') {
                delete_account();
            }
            $(this)[0].selectedIndex = 0;
        });
    
        $('#i18n').change(function () {
            $(this).submit();
        });
        
        $('#log_out').on('click', function () {
            window.location = "{% url 'logout' %}";
        });
        
        $('#delete_account').on('click', function () {
            answer = prompt("{% trans '帳號即將刪除，刪除後資料無法回復，如確定要刪除請輸入YES' %}", '');
            if (answer == 'YES') {
                window.location = "{% url 'delete_account' %}";
            }  else {
                alert("{% trans '刪除動作已取消' %}")
            }
        });
    })
</script>