{% load i18n %}
{% trans '帳號管理' as account_management %}
{% trans '更改密碼' as change_password %}
{% trans '登出' as log_out %}
{% trans '刪除帳號' as delete_account %}
<div>
    <!-- navbar top -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation" id="navbar">
        <!-- navbar-header -->
        <div class="navbar-header" style="padding-top:20px">
            <a class="navbar-brand" href="{% url 'home' %}">
                <font size="6" color="white" style="font-weight:bold;">Data Anonymization System</font>
            </a>
        </div>
        <!-- end navbar-header -->
        <!-- navbar-top-links -->
        <ul class="nav navbar-top-links navbar-right">
            <!-- main dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)">
                    <i class="fa fa-user fa-3x"></i>
                </a>
                <!-- dropdown user-->
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="javascript:void(0)" onclick="change_password()"><i class="fa fa-key fa-fw"></i>{% trans '更改密碼' %}</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="{% url 'logout' %}"><i class="fa fa-sign-out fa-fw"></i>{% trans '登出' %}</a>
                    </li>
                    <li><a href="javascript:void(0)" onclick="delete_account()"><i class="fa fa-trash-o fa-fw"></i>{% trans '刪除帳號' %}</a>
                    </li>
                </ul>
                <!-- end dropdown-user -->
            </li>
            <!-- end main dropdown -->
        </ul>
        <!-- end navbar-top-links -->

    </nav>
<!-- end navbar top -->
    <div id="alert" style="display:none;z-index:100;position:fixed;width:100%;opacity:0.9;" class="alert row">
        <h3 id="alert_text" class="col-md-11"></h3>
        <button type="button" class="close" style="padding-top:20px" onclick="close_alert()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
</div>
    
<script>
    alert_jquery = $('#alert');
    alert_text_jquery = $('#alert_text');
    
    function initial_alert(text) {
        alert_jquery.removeClass();
        alert_jquery.addClass('alert row');
        alert_text_jquery.text(text);
        alert_jquery.show();
        window.scrollTo(0, 0);
    }
    
    function danger_alert(text) {
        initial_alert(text);
        alert_jquery.addClass('alert-danger');
        alert_jquery.fadeOut(3000, close_alert);
    }
    
    function success_alert(text) {
        initial_alert(text);
        alert_jquery.addClass('alert-success');
        alert_jquery.fadeOut(3000, close_alert);
    }
    
    function warning_alert(text) {
        initial_alert(text);
        alert_jquery.addClass('alert-warning');
        alert_jquery.fadeOut(3000, close_alert);
    }
        
    function close_alert() {
        alert_jquery.hide();
    }
    
    function delete_account() {
        {% if not user.is_authenticated %}
            warning_alert("{% trans '請先登入' %}");
            return;
        {% endif %}
        var answer = prompt("{% trans '帳號即將刪除，刪除後資料無法回復，如確定要刪除請輸入密碼' %}", '');
        var url = "{% url 'password_check' %}";
        var data = {
            'password' : answer,
        };
        $.ajax({
            url: url,
            type: 'GET',
            data: data,
            success: function () {
                window.location = "{% url 'delete_account' %}";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var jsonObj = JSON.parse(xhr.responseText);
                danger_alert(jsonObj.message);
            }
        });
    }
    
    function change_password() {
        {% if not user.is_authenticated %}
            warning_alert("{% trans '請先登入' %}");
            return;
        {% endif %}
        var answer = prompt("{% trans '請輸入原本的密碼，以繼續進行密碼更改' %}", '');
        var url = "{% url 'password_check' %}";
        var data = {
            'password' : answer,
        };
        $.ajax({
            url: url,
            type: 'GET',
            data: data,
            success: function () {
                window.location = "{% url 'change_password' %}";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var jsonObj = JSON.parse(xhr.responseText);
                danger_alert(jsonObj.message);
            }
        });
    }
</script>