{% load i18n %}
{% trans '帳號管理' as account_management %}
{% trans '更改密碼' as change_password %}
{% trans '登出' as log_out %}
{% trans '刪除帳號' as delete_account %}
<div>
    <nav class="navbar navbar-expand-sm fixed-top" style="background-color:#3399ff">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="navbar-brand" href="{% url 'home' %}" style="color:#ffffff">{% trans '主頁' %}</a>
            </li>
            <li class="nav-item">
                <a class="navbar-brand" href="{% url 'DPView:home' %}" style="color:#ffffff">DPView</a>
            </li>
            <li class="nav-item" >
                <a class="navbar-brand" href="{% url 't_Closeness:home' %}" style="color:#ffffff">k-Anonymity</a>
            </li>
            {% if false %}
                <li class="nav-item">
                    <a class="navbar-brand" href="{% url 'k_Anonymity:home' %}" style="color:#ffffff">k-Anonymity</a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="{% url 'l_Diversity:home' %}" style="color:#ffffff">l-Diversity</a>
                </li>
            {% endif %}
            <li class="nav-item">
                <a class="navbar-brand" href="{% url 'update_log' %}" style="color:#ffffff">{% trans '更新日誌' %}</a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item">
                <select id="account" name="account" class="form-control">
                    <option value="{{ account_management }}" selected>{{ account_management }}</option>
                    <option value="{{ change_password }}">{{ change_password }}</option>
                    <option value="{{ log_out }}">{{ log_out }}</option>
                    <option value="{{ delete_account }}">{{ delete_account }}</option>
                </select>
            </li>
            {% endif %}
            <li class="nav-item">
                <form id="i18n" action="{% url 'set_language' %}" method="post">
                    {% csrf_token %}
                    <input name="next" type="hidden" value="{{ request.get_full_path|remove_language_code }}" />
                    <select name="language" class="form-control language-switch">
                        {% for code, name in LANGUAGES %}
                            <option value="{{ code }}" {% if code == LANGUAGE_CODE %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </form>
            </li>
        </ul>
    </nav>
</div>

<script>
    $(function () {
        $('#account').change(function () {
            selected = $(this).find(':selected').val();
            if (selected == '{{ log_out }}') {
                window.location = "{% url 'logout' %}";
            } else if (selected == '{{ delete_account }}') {
                delete_account();
            } else if (selected == '{{ change_password }}') {
                change_password();
            }
            $(this)[0].selectedIndex = 0;
        });
    
        $('#i18n').change(function () {
            $(this).submit();
        });
    })
    
    function delete_account() {
        var answer = prompt("{% trans '帳號即將刪除，刪除後資料無法回復，如確定要刪除請輸入密碼' %}", '');
        var url = "{% url 'password_check' %}";
        var data = {
            'password' : answer,
        };
        $.ajax({
            url: url,
            type: 'GET',
            data: data,
            success: function () {
                window.location = "{% url 'delete_account' %}";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var jsonObj = JSON.parse(xhr.responseText);
                alert(jsonObj.message);
            }
        });
    }
    
    function change_password() {
        var answer = prompt("{% trans '請輸入原本的密碼，以繼續進行密碼更改' %}", '');
        var url = "{% url 'password_check' %}";
        var data = {
            'password' : answer,
        };
        $.ajax({
            url: url,
            type: 'GET',
            data: data,
            success: function () {
                window.location = "{% url 'change_password' %}";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var jsonObj = JSON.parse(xhr.responseText);
                alert(jsonObj.message);
            }
        });
    }
</script>