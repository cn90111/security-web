{% extends "general/function.html" %}
{% block title %}k-Anonymity{% endblock title %}
{% block output_path %}k_Anonymity{% endblock output_path %}
{% block home_path %}k_Anonymity{% endblock home_path %}
{% block content %}
    <h2>k-Anonymity</h2>
    <h5 style="font-weight:bold;color:red">說明1：將滑鼠移至欄位上可查看欄位說明</h5>
    <h5 style="font-weight:bold;color:red">說明2：去識別化後的檔案可用性高，但執行速度較慢，可先執行 t-Closeness 測試是否符合需求</h5>
    <p>
        Description : 
    </p>
{% endblock content %}
{% block form %}
    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="k" data-toggle="tooltip" title="去識別化後，在任意查詢條件下，至少會同時查到K筆資料">K：</label>
            <input type="text" class="form-control" id="k" placeholder="" required="required" pattern="^[0-9]+$" value="2" data-toggle="tooltip" title="去識別化後，在任意查詢條件下，至少會同時查到K筆資料">
        </div>
    </div>
{% endblock form %}
{% block execute %}
    <script>
        $(function () {
            $('#execute').on('click', function () {
                if (check_required_is_empty()) {
                    alert('請選擇檔案，若無檔案請先上傳檔案')
                    return
                }
                reset()
                window.scrollTo(0, document.body.scrollHeight)
                var mm = window.setInterval("Check_Time()", 1000);
                $('#execute').attr('disabled', 'disabled');
                console.log("come in k_Anonymity")
                var csv_name_value = document.getElementById("csv_name_select").value;
                var k_value = document.getElementById("k").value;
                var log = "";
                var sitv = setInterval( function () {
                    var prog_url = '/k_Anonymity/show_k_progress/'
                    $.getJSON(prog_url, function (data) {
                        {# console.log("come in num_progress="+num_progress)#}
                        $('.progress-div').css('visibility', 'visible');
                        $('.progress-bar').css('width', data.num_progress + '%');
                        $('.progress-bar').text(data.num_progress + '%');
                        $('.progress-text').text( '目前進度：'+ data.log );
                        $('.progress-text').css('width', '100%');
                        $('#prog_in').width(data.num_progress + '%');
                    });
                }, 10000);
                var thisurl = '/k_Anonymity/Execute_k_Anonymity/'
                $.getJSON(thisurl,
                    {
                        csv_name : csv_name_value,
                        k : k_value,
                    }, function (num_progress) {
                    clearInterval(sitv);
                    clearInterval(mm);
                    $('.progress-bar').css('width', '100%');
                    $('.progress-bar').text('100%');
                    $('#bar').removeClass('active');
                    $('.progress-text').text('執行完成');
                    $('#execute').removeAttr('disabled');
                });
            })
        })
    </script>
{% endblock execute %}