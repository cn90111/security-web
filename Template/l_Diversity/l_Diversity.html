{% extends "general/function.html" %}
{% block title %}l-Diversity{% endblock title %}
{% block content %}
    <h2>l-Diversity</h2>
    <h5 style="font-weight:bold;color:red">說明：去識別化後的檔案可用性高，但執行速度較慢，可先執行 t-Closeness 測試是否符合需求</h5>
    <p>
        Description : 
    </p>
{% endblock content %}
{% block form %}
    <div class="form-row" style="height:110px">
        <div class="form-group col-md-4">
            <label for="csv_name_select">CSV_Name：</label>
            <select class="form-control" id="csv_name_select" >
                {% for key in s %}
                    <option value="{{ key }}">{{ key }}</option>
                {%endfor%}
            </select>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="k">K：</label>
            <input type="text" class="form-control" id="k" placeholder="" required="required" pattern="^[0-9]+$" disabled="disabled" value="2">
            <div class="help-block with-errors"></div>
        </div>
        <div class="form-group col-md-4">
            <label for="l">L：</label>
            <input type="text" class="form-control" id="l" placeholder="" disabled="disabled" value="2">
            <div class="help-block with-errors"></div>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-md-2">
            <button id="execute" type="button" class="btn btn-primary" style="width:100%">執行</button>
        </div>
        <div class="form-group col-md-2">
            <div onclick="location.href='/l_Diversity/File_List_Output/'"  type="button" class="btn btn-primary" style="width:100%">已完成檔案列表</div>
        </div>
        <div class="form-group col-md-2">
            <div onclick="location.href='/l_Diversity/'" class="btn btn-primary" type="button" style="width:100%">返回主頁</div>
        </div>
    </div>
{% endblock form %}
{% block execute %}
    <script>
        $(function () {
            $('#execute').on('click', function () {
                var mm = window.setInterval("Check_Time()", 1000);
                $('#execute').attr('disabled', 'disabled');
                console.log("come in l_Diversity.")
                var csv_name_value = document.getElementById("csv_name_select").options[document.getElementById("csv_name_select").selectedIndex].value;
                var k_value = document.getElementById("k").value;
                var l_value = document.getElementById("l").value;
                var log = "";
                var sitv = setInterval( function () {
                    var prog_url = '/l_Diversity/show_l_progress/'
                    $.getJSON(prog_url, function (data) {
                        {# console.log("come in num_progress="+num_progress)#}
                        $('.progress-div').css('visibility', 'visible');
                        $('.progress-bar').css('width', data.num_progress + '%');
                        $('.progress-bar').text(data.num_progress + '%');
                        $('.progress-text').text( '目前進度：'+ data.log );
                        $('.progress-text').css('width', '100%');
                        $('#prog_in').width(data.num_progress + '%');
                    });
                }, 10000);
                var thisurl = '/l_Diversity/Execute_l_diversity/'
                $.getJSON(thisurl,
                    {
                        csv_name : csv_name_value,
                        k : k_value,
                        l : l_value,
                    }, function (num_progress) {
                    clearInterval(sitv);
                    clearInterval(mm);
                    $('.progress-bar').css('width', '100%');
                    $('.progress-bar').text('100%');
                    $('#bar').removeClass('active');
                    $('.progress-text').text('執行完成');
                    $('#execute').removeAttr('disabled');
                });
            })
        })
    </script>
{% endblock execute %}