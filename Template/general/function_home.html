<!DOCTYPE html>
{% load i18n %}
<html lang="en">
	<head>
        <meta charset="UTF-8">
        <title>{% block title %}title{% endblock title %}</title>
        {% load static %}
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    	<script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	</head>
	<body style="padding-top:50px;">
        {% include 'navbar.html' %}
        <div class="jumbotron jumbotron-fluid">
            <div class="container">
                {% block content %}
                    <h2>function name</h2>
                    <h5 style="font-weight:bold;color:red">{% trans '注意事項1：' %}</h5>
                {% endblock content %}
            </div>
        </div>
	   	<div class="container">
            <h2 id="loading" style="display:none">{% trans '檔案上傳中，請稍後' %}</h2>
            <form id="form_file" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="custom-file center" style="height:80px">
                    <input type="file" class="custom-file-input" name="file" id="customFile_csv" accept=".csv" >
                    <label class="custom-file-label" for="customFile_csv">{% trans '請選擇將要去識別化的CSV檔案(.csv)' %}</label>
                </div>
            </form>
        </div>
        
        <script>
            function isValidFile(file) {
                var type = "." + file.value.split(".")[1];
                if (type == file.accept) {
                    return true;
                }
                return false;
            }
            
            function reset() {
                $("#customFile_csv").val('')
            }
        
            $("#customFile_csv").on("change", function() {
                var csv_name = $(this).val().split("\\").pop();
                $('#loading').show()
                $(this).siblings(".custom-file-label").addClass("selected").html(csv_name);
                
                if (!csv_name) {
                    alert("{% trans '請先選擇檔案' %}");
                    $('#loading').hide()
                    return;
                }
                
                if (!isValidFile(document.getElementById('customFile_csv'))) {
                    alert("{% trans '檔案類型錯誤' %}");
                    $('#loading').hide()
                    return;
                }
                let formData = new FormData($('#form_file').get(0));
                
                $.ajax({
                    url: '/general/File_Upload/{% block upload_mode %}json{% endblock upload_mode %}',
                    type: 'POST',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function () {
                        reset()
                        window.location = '/{% block custom_url %}json_parser{% endblock custom_url %}/custom/csv_name='+csv_name+'/';
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        var jsonObj = JSON.parse(xhr.responseText);
                        alert(jsonObj.message);
                        $('#loading').hide()
                    }
                });
            });
        </script>
	</body>
</html>